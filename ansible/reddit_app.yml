---
- name: Con§igure hosts & deploy application
  hosts: all
  vars:
       mongo_bind_ip: 0.0.0.0
  tasks:
    - name: Change mongo config file
      become: true # <-- Выполнить задание от root
      template:
        src: templates/mongod.conf.j2 # <-- Путь до локального файла-шаблона
        dest: /etc/mongod.conf # <-- Путь на удаленном хосте
        mode: 0644 # <-- Права на файл, которые нужно установить
      tags: db-tag
      notify: restart mongod
      
  handlers: 
  - name: restart nongo
    become: true
    service: name=mongod state=restarted

  - name: reload puma
    become: true
    systemd: name=puma state=restarted

  - name: Add unit file for Puma
  become: true
  copy:
    src: files/puma.service
    dest: /etc/systemd/system/puma.service
  tags: app-tag
  notify: reload puma

- name: enable puma
  become: true
  systemd: name=puma enabled=yes
  tags: app-tag

